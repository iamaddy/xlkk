<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: lazy.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: lazy.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * 图片延时加载插件
 *
 * @module lazy
 * @author lijunjun
 * @version 1.0
 */
define(['eventutil'], function(e){
	"use strict";
	var LAZY = {};
	LAZY=(function(){
		var pResizeTimer = null,
		imgs={};

		function position(o){
			var p={Top:0,Left:0};
			while(!!o){
				p.Top+=o.offsetTop;
				p.Left+=o.offsetLeft;
				o=o.offsetParent;
			}
			return p;
		}

		function resize_run(){
			var i,
			min={},
			max={},
			_img, img, width, height, wh;
	        min.Top = document.body.scrollTop + document.documentElement.scrollTop;
			min.Left=document.documentElement.scrollLeft;
			max.Top=min.Top+document.documentElement.clientHeight;
			max.Left=min.Left+document.documentElement.clientWidth;

			for(i in imgs){
				if(imgs[i]){
					_img=imgs[i];
					img = document.getElementById(i);
					width = img.clientWidth;
					height = img.clientHeight;
					wh=position(img);
					if( (wh.Top>=min.Top && wh.Top&lt;=max.Top && wh.Left>=min.Left && wh.Left&lt;=max.Left) || ((wh.Top+height)>=min.Top && wh.Top&lt;=max.Top && (wh.Left+width)>=min.Left && wh.Left&lt;=max.Left)){
						(function(imgobj,realsrc){
							setTimeout(function() {imgobj.src = realsrc ;}, 100) ;
						})(img,_img.src) ;
						delete imgs[i];
					}

				}
			}
		}

		function resize(){
			if(pResizeTimer){
				return '';
			}
			resize_run();
		}

		
		/** @lends lazy */
		return {
			/**
	         * 初始化
	         *
	         * @method module:lazy.init
	         */
			init:function(){
				var i = 0,ttiframes=document.body.getElementsByTagName("iframe"),img,config;
				for(i=0;i&lt;document.images.length;i++){
					img = document.images[i];
					config={};
					config.id = img.id;
					config.src = img.getAttribute('_src');
					if(config.src && !config.id){
						config.id = encodeURIComponent(config.src) + Math.random();
						img.id = config.id;
					}
					if(!config.id || !config.src){
						continue;
					}
					LAZY.push(config);
				}

				for(i=0;i&lt;ttiframes.length;i++){
					config={};
					config.id = ttiframes[i].id;
					config.src = ttiframes[i].getAttribute('_src');
					if(config.src && !config.id){
						config.id = encodeURIComponent(config.src) + Math.random();
						ttiframes[i].id = config.id;
					}
					if(!config.id || !config.src){
						continue;
					}
					LAZY.push(config);
				}
			},

			/**
	         * 添加需要延时加载的图片
	         *
	         * @method module:lazy.push
	         * @param config 封装好的图片对象
	         */
			push:function(config){
				imgs[config.id] = config;
			},

			/**
	         * 注册浏览器滚动事件，触发延时加载
	         *
	         * @method module:lazy.run
	         */
			run:function(){
				e.addEventHandler(window,'scroll',resize);
				resize_run();
			}
		};
	})();
	return LAZY;
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Modules</h3><ul><li><a href="module-cookie.html">cookie</a></li><li><a href="module-dom.html">dom</a></li><li><a href="module-dy.html">dy</a></li><li><a href="module-eventutil.html">eventutil</a></li><li><a href="module-focuspic.html">focuspic</a></li><li><a href="module-Hashtable.html">Hashtable</a></li><li><a href="module-ioCtrl.html">ioCtrl</a></li><li><a href="module-keyevent.html">keyevent</a></li><li><a href="module-kkpgv.html">kkpgv</a></li><li><a href="module-lazy.html">lazy</a></li><li><a href="module-minisite.html">minisite</a></li><li><a href="module-stillList.html">stillList</a></li><li><a href="module-storage.html">storage</a></li><li><a href="module-switchtab.html">switchtab</a></li><li><a href="module-turn.html">turn</a></li><li><a href="module-vip.html">vip</a></li><li><a href="module-vote.html">vote</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Thu Mar 28 2013 14:29:10 GMT+0800 (CST)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
